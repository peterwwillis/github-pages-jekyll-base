<h1>Overview</h1>

This repository is intended to help you set up and locally test a new GitHub Pages site.

It can be really annoying to test GitHub Pages sites locally, so I've added some scripts to work around some common problems.

## Getting Started

To use this repository, first set up the environment and files.
 1. Install dependencies
   - `apt-get update && apt-get install -y git make docker`
 2. Clone the repository
   - `git clone https://github.com/peterwwillis/github-pages-jekyll-base`
 3. Copy `envrc.sample` to `envrc`
   - `cp envrc.sample envrc`
 3. Edit `_config.yml`, `envrc`, and `robots.txt` as necessary

To test your site in a Docker container, run:
   - `make docker.serve`

To test your site without Docker, run:
   - `make serve`

<br />

---

<br />

# Design

This repository tries to replicate the environment that GitHub Pages uses to run Jekyll.
If you don't do this, you can waste a lot of time trying to track down problems with
various Jekyll dependencies.

It is suggested to use the Docker images as it's easier to change and update the
environment used to build the Ruby dependencies for Jekyll.

## Option 1: Docker (recommended)
First off, there are 2 Dockerfiles you can use, both of which are based on Dockerfiles
from the GitHub Pages gem repository. By default we use one based on Ubuntu, but you
can also opt for the Alpine image. Currently only the Ubuntu-based one pins the version
of Ruby.

The Docker images copy the Gemfile and then call 'bundle install' to set up Jekyll.
If your dependencies change, the Docker image will automatically rebuild.

The generated site pages as well as any vendor-specific Ruby files are kept in the container
with the `-d /_site` option to Jekyll. You can also map these to a Docker volume.

You can also modify the 'jekyll.sh' script to perform other actions before it runs `jekyll`
inside the container.

## Option 2: Locally built Ruby
If you don't use Docker, you can install a local copy of Ruby with rvm and maintain
all your Ruby and Jekyll dependencies manually. This can be annoying, so there's some
code here to make this process easier.

You can run `make build` and `make serve`, and `rvm` will automatically be
downloaded and installed along with Jekyll dependencies.

You should add and commit the `Gemfile.lock` file once Jekyll is working for you.
If your `Gemfile.lock` changes, `make` will fail and ask you to commit the changes.
This is so that if dependencies change, you can back them out if they break things.

<br />

---

<br />

# Files used here

Some of the files here can be automatically regenerated; run `make clean.all` to remove
them, and subsequent uses of `make docker` or `make serve` should automatically
download new versions. You can then commit the updates to your repository.

## `Makefile`
This config instructs `make` on how to build and run Jekyll. Read the file to find more
`make` targets that may be useful to you during development.

## `envrc`
This file sets some values to help with building and running Jekyll. Edit this file to
contain your GitHub repo and load your GitHub Personal Access Token.

## `_config.yml`
This is the Jekyll configuration file. Refer to GitHub Pages' official documentaiton on
how to set up this file.

## `Gemfile`
The Gemfile here defines all the ruby dependencies for setting up GitHub Pages and Jekyll.
The defaults come from those published by GitHub.

If you need to update your ruby dependencies, run the following commands:
   - `make clean-gemfile Gemfile`

## `Gemfile.lock`
This file is automatically generated when you run Jekyll. This file's changes will
often break Jekyll.

If you commit the `Gemfile.lock` to your repository, you can run `make fail-if-gemfile-changed`
to force make to exit if the file has been modified locally. This way you can detect if
the file changes, review the changes, test them, and then commit them. If Jekyll breaks as
this file changes, back out the changes and find out what broke.

## `.ruby-version`
The ruby version is what's pinned in the GitHub Pages repo. They advertise an old version
of Ruby as the minimum version, but Jekyll won't build with that, so we use what they're
actually using.

To update this version, run:
   - `rm -f .ruby-version`
   - `make .ruby-version`

The default Dockerfile and the local builds both use this file to determine the version of
Ruby to use, and this in turn effects the Jekyll dependencies.

## `robots.txt`
Edit this to point at your site's sitemap.
